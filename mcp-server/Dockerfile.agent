# Dockerfile.agent - Template for MCP Agent servers
# Usage: Build with agent name parameter
# docker build -f Dockerfile.agent --build-arg AGENT_NAME=general -t general-agent-mcp .

ARG AGENT_NAME=general

FROM node:22-alpine

WORKDIR /app

ARG AGENT_NAME

# Copy all files
COPY utils/ ./utils/
COPY mcp-server/shared/package*.json ./shared/
COPY mcp-server/shared/ ./shared/
COPY mcp-server/${AGENT_NAME}-mcp-server/package*.json ./
COPY mcp-server/${AGENT_NAME}-mcp-server/ ./

# Copy data files (CSV) for agents that need them
COPY mcp-server/${AGENT_NAME}-mcp-server/*.csv ./

# Install utils dependencies first
RUN cd utils && npm install --only=production

# Install shared and main dependencies
RUN npm install && \
    cd shared && npm install --only=production

# Copy data files (CSV) for agents that need them
COPY mcp-server/${AGENT_NAME}-mcp-server/*.csv ./

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=30s --retries=3 \
  CMD node -e "console.log('Health Check - OK')" || exit 1

EXPOSE 3000

CMD ["node", "server.js"]